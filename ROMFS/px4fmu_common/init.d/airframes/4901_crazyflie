#!nsh
#
# @name Crazyflie 2.0
#
# @type Quadrotor x
# @class Copter
#
# @maintainer Dennis Shtatov <densht@gmail.com>
#

sh /etc/init.d/rc.mc_defaults

#Parameters here:

# Set mixer
set MIXER quad_6x

set PWM_OUT 123456

# Configure this as Quadrotor
if [ $AUTOCNF = yes ]
then
	param set BAT_N_CELLS 1
	param set BAT_CAPACITY 240
	param set BAT_SOURCE 0
	param set BAT_ADC_CHANNEL 0

	param set CBRK_SUPPLY_CHK 894281
	param set CBRK_USB_CHK 197848
	param set COM_RC_IN_MODE 1
	param set COM_RC_LOSS_T	2.0

	param set EKF2_ABL_LIM 2.0
	param set EKF2_AID_MASK 3
	param set EKF2_HGT_MODE 2
	param set EKF2_MAG_TYPE 1
	param set EKF2_OF_DELAY 10

	param set IMU_GYRO_CUTOFF 100
	param set IMU_ACCEL_CUTOFF 30

	param set MC_AIRMODE 1
	param set MC_DTERM_CUTOFF 70
	param set MC_PITCHRATE_D 0.002
	param set MC_PITCHRATE_I 0.2
	param set MC_PITCHRATE_P 0.07
	param set MC_PITCH_P 6.5
	param set MC_ROLLRATE_D 0.002
	param set MC_ROLLRATE_I 0.2
	param set MC_ROLLRATE_P 0.07
	param set MC_ROLL_P 0
	param set MC_YAW_P 1.0
 
	param set MPC_THR_HOVER 0.5
	param set MPC_THR_MAX 1.0
	param set MPC_Z_P 1.0
	param set MPC_Z_VEL_I 0.2
	param set MPC_Z_VEL_P 0.3
	param set MPC_HOLD_MAX_XY 0.1
	param set MPC_MAX_FLOW_HGT 3

	param set NAV_RCL_ACT 3
	param set NAV_DLL_ACT 5
	
	param set PWM_DISARMED 0
	param set PWM_MIN 0
	param set PWM_MAX 510
	param set PWM_MAIN_DIS1	255
	param set PWM_MAIN_DIS2	255
	param set PWM_MAIN_DIS3	255
	param set PWM_MAIN_DIS4	255
	param set PWM_MAIN_DIS5	0
	param set PWM_MAIN_FAIL1 255
	param set PWM_MAIN_FAIL2 255
	param set PWM_MAIN_FAIL3 255
	param set PWM_MAIN_FAIL4 255
	param set PWM_MAIN_FAIL5 0
	param set PWM_MAIN_MAX1	510
	param set PWM_MAIN_MAX2	510
	param set PWM_MAIN_MAX3	510
	param set PWM_MAIN_MAX4	510
	param set PWM_MAIN_MAX5	510
	param set PWM_MAIN_MAX6	510

	# Run the motors at 328.125 kHz (recommended)
	param set PWM_RATE 3921

	param set SDLOG_PROFILE 1

	param set SENS_FLOW_MINRNG 0.05

	param set SYS_FMU_TASK 1

fi

set PWM_DISARMED none
set PWM_MAX none
set PWM_MIN none

#syslink start
#mavlink start -d /dev/bridge0 -b 57600 -m osd -r 40000

